{
  "hash": "b5b7e2e62f806ca406edae9c150bd9dd",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"LME 2\"\n---\n\n\n\n\n\n\n\n- Tutorial: [TileStats: Linear mixed effects models - random slopes and interactions | R and SPSS](https://youtu.be/oI1_SV1Rpfc?si=O6cJRgUl01IZ1Ks4)\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndiet_df <- data.frame(\n  person = c(\"Person 1\", \"Person 2\", \"Person 3\", \"Person 4\"),\n  diet = c(\"A\", \"A\", \"B\", \"B\"),\n  wt_before = c(102L, 96L, 83L, 79L),\n  wt_1wk = c(97L, 93L, 79L, 77L),\n  wt_2wk = c(95L, 87L, 78L, 75L),\n  wt_3wk = c(93L, 85L, 74L, 72L)\n)\ndiet_df\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    person diet wt_before wt_1wk wt_2wk wt_3wk\n1 Person 1    A       102     97     95     93\n2 Person 2    A        96     93     87     85\n3 Person 3    B        83     79     78     74\n4 Person 4    B        79     77     75     72\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndiet_df_long <- diet_df %>% \n  pivot_longer(cols = starts_with(\"wt\"), \n               names_to = \"time\", names_prefix = \"wt_\", values_to = \"weight\") %>% \n  mutate(time = factor(time, levels = c(\"before\", paste0(1:3, \"wk\")))) %>% \n  mutate(time = case_when(time == \"before\" ~ 0,\n                          time == \"1wk\" ~ 1,\n                          time == \"2wk\" ~ 2,\n                          time == \"3wk\" ~ 3,\n                          ))\n```\n:::\n\n\n\n\n\n## Multiple Linear Reg\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndiet_df_long %>% \n  ggplot(aes(time, weight, colour = diet)) +\n  geom_point(size = 3) +\n  geom_smooth(method = \"lm\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](lm-mixed-2_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlm(weight ~ time + diet, data = diet_df_long) %>% summary()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = weight ~ time + diet, data = diet_df_long)\n\nResiduals:\n   Min     1Q Median     3Q    Max \n-5.013 -1.969 -0.125  2.100  4.037 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  97.9625     1.4423  67.922  < 2e-16 ***\ntime         -2.9750     0.6618  -4.496 0.000602 ***\ndietB       -16.3750     1.4798 -11.066 5.49e-08 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 2.96 on 13 degrees of freedom\nMultiple R-squared:  0.9165,\tAdjusted R-squared:  0.9036 \nF-statistic: 71.33 on 2 and 13 DF,  p-value: 9.803e-08\n```\n\n\n:::\n:::\n\n\n\n\n## Mixed Effect\n\n- Random effect should have **≥ 5 levels**\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(lme4)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'lme4' was built under R version 4.3.3\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: Matrix\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'Matrix'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:tidyr':\n\n    expand, pack, unpack\n```\n\n\n:::\n:::\n\n\n\n\n### Random Intercept\n\n(Plot is approximation)\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndiet_df_long %>% \n  ggplot(aes(time, weight, colour = diet)) +\n  geom_point(size = 3) +\n  geom_line(aes(group = person))\n```\n\n::: {.cell-output-display}\n![](lm-mixed-2_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndiet_m4 <- lmer(weight ~ time + (1 | person), data = diet_df_long, REML = F)\nsummary(diet_m4)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear mixed model fit by maximum likelihood  ['lmerMod']\nFormula: weight ~ time + (1 | person)\n   Data: diet_df_long\n\n     AIC      BIC   logLik deviance df.resid \n    78.2     81.3    -35.1     70.2       12 \n\nScaled residuals: \n     Min       1Q   Median       3Q      Max \n-1.59974 -0.76145 -0.02532  0.71385  1.20036 \n\nRandom effects:\n Groups   Name        Variance Std.Dev.\n person   (Intercept) 72.965   8.542   \n Residual              1.186   1.089   \nNumber of obs: 16, groups:  person, 4\n\nFixed effects:\n            Estimate Std. Error t value\n(Intercept)  89.7750     4.2952   20.90\ntime         -2.9750     0.2436  -12.21\n\nCorrelation of Fixed Effects:\n     (Intr)\ntime -0.085\n```\n\n\n:::\n:::\n\n\n\n\n**Intercept:**\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nranef(diet_m4)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$person\n         (Intercept)\nPerson 1   11.391193\nPerson 2    4.917510\nPerson 3   -6.784918\nPerson 4   -9.523784\n\nwith conditional variances for \"person\" \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlmer(weight ~ time + (1 | person), data = diet_df_long) %>% broom.mixed::tidy()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 × 6\n  effect   group    term            estimate std.error statistic\n  <chr>    <chr>    <chr>              <dbl>     <dbl>     <dbl>\n1 fixed    <NA>     (Intercept)        89.8      4.96       18.1\n2 fixed    <NA>     time               -2.97     0.254     -11.7\n3 ran_pars person   sd__(Intercept)     9.87    NA          NA  \n4 ran_pars Residual sd__Observation     1.14    NA          NA  \n```\n\n\n:::\n:::\n\n\n\n\n### Random Intercept & Slope\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndiet_m4_2 <- lmer(weight ~ time + (1 + time | person), data = diet_df_long, REML = F)\nsummary(diet_m4_2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear mixed model fit by maximum likelihood  ['lmerMod']\nFormula: weight ~ time + (1 + time | person)\n   Data: diet_df_long\n\n     AIC      BIC   logLik deviance df.resid \n    80.1     84.8    -34.1     68.1       10 \n\nScaled residuals: \n     Min       1Q   Median       3Q      Max \n-1.66980 -0.49134  0.01578  0.59857  1.34248 \n\nRandom effects:\n Groups   Name        Variance Std.Dev. Corr \n person   (Intercept) 81.8806  9.0488        \n          time         0.1494  0.3865   -0.88\n Residual              0.9375  0.9683        \nNumber of obs: 16, groups:  person, 4\n\nFixed effects:\n            Estimate Std. Error t value\n(Intercept)  89.7750     4.5425   19.76\ntime         -2.9750     0.2902  -10.25\n\nCorrelation of Fixed Effects:\n     (Intr)\ntime -0.634\n```\n\n\n:::\n:::\n",
    "supporting": [
      "lm-mixed-2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}